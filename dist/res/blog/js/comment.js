"use strict";!function(){function t(){$("#xei-cmt-wrapper").on("click",".xei-cmt-post-button",function(){n($(this).parent().prev()[0])}),$("#xei-cmt-wrapper").on("click","[data-del-id]",function(){if(confirm("确定要删除该条评论吗？该评论下的所有子评论也都将被删除哦！")){var t=this.dataset.delId;x("/del_comment",{id:t},function(e){0==e.code?(r(parseInt(e.text)),$('#xei-cmt-wrapper [data-cmt-id="'+t+'"]').hide("normal",function(){$(this).remove()})):u(e.text)})}}),$("#xei-cmt-wrapper").on("click","[data-reply-id]",function(){var t=$(this).parent(),e=(t.next(".xei-cmt-replybox"),this.dataset.replyId);if(null==W||($('[data-reply-id="'+W+'"]').parent().next(".xei-cmt-replybox").remove(),W!=e)){var i=$(this).parents(".xei-cmt-comment:last")[0].dataset.cmtId;t.after(s(e,i)),W=e,t.next(".xei-cmt-replybox").find("textarea")[0].focus()}else W=null}),$("#xei-cmt-wrapper").on("click","[data-zan-id]",function(t){var e=this,i=e.dataset.zanId,a=e.classList.contains("liked");x(a?"/cancel_zan_comment":"/add_zan_comment",{targetType:"comment",targetKey:i,type:"zan"},function(t){0==t.code?(a?e.classList.remove("liked"):e.classList.add("liked"),e.querySelector(".zan-count").innerHTML=t.count):(1==t.code&&e.classList.add("liked"),u(t.text))},!0)}),$("#xei-cmt-wrapper [data-sort-type]").click(function(t){$('#xei-cmt-wrapper [data-sort-type="'+I+'"]').removeClass("current"),I=this.dataset.sortType,$(this).addClass("current"),a(),xei.setCookie(C,I)}),$("#xei-cmt-wrapper [placeholder]").click(function(t){var e=$(this).attr("placeholder");e&&(this.dataset.placeholder=e,$(this).attr("placeholder",""))}),$("#xei-cmt-wrapper [placeholder]").on("blur",function(t){var e=this.dataset.placeholder;e&&(this.dataset.placeholder="",$(this).attr("placeholder",e))}),$("#xei-cmt-wrapper").on("keyup","textarea",function(t){t.ctrlKey&&13==t.keyCode&&n(this)}),$("#xei-cmt-logout").click(function(t){x("/open_user_logout",{},function(){L={avatar:"",nickname:"游客",website:"/"},m(),a()})}),$("#xei-cmt-wrapper").on("click",".xei-cmt-icon-qq",function(t){e()}),$("#xei-cmt-wrapper").on("click",".xei-cmt-icon-weibo",function(t){i()}),$("#xei-cmt-wrapper").on("click",".xei-cmt-page > [data-page]",function(t){a(parseInt(this.dataset.page))}),window.addEventListener("message",function(t){console.log(t),0==y.indexOf(t.origin)&&function(t){if(0!==t.code)return void u(t.text);L=t.user,m();var e=T.textarea;e&&e.value&&n(e)}(t.data)}),function(){function t(t,i){(i=void 0==i?$(".xei-qq-face-wrapper"):$(i).parents(".xei-cmt-replybox").children(".xei-qq-face-wrapper"))[t?"show":"hide"]("normal"),window[t?"addEventListener":"removeEventListener"]("click",e,!0)}function e(e){for(var i=$(".xei-qq-face-wrapper")[0],a=e.target,n=a==i,r=a;!n&&(r=r.parentElement);)if(r==i){n=!0;break}n||t(!1)}var i=-1,a=["微笑","撇嘴","色","发呆","得意","流泪","害羞","闭嘴","睡","大哭","尴尬","发怒","调皮","呲牙","惊讶","难过","酷","冷汗","抓狂","吐","偷笑","可爱","白眼","傲慢","饥饿","困","惊恐","流汗","憨笑","大兵","奋斗","咒骂","疑问","嘘","晕","折磨","衰","骷髅","敲打","再见","擦汗","抠鼻","鼓掌","糗大了","坏笑","左哼哼","右哼哼","哈欠","鄙视","委屈","快哭了","阴险","亲亲","吓","可怜","菜刀","西瓜","啤酒","篮球","乒乓","咖啡","饭","猪头","玫瑰","凋谢","示爱","爱心","心碎","蛋糕","闪电","炸弹","刀","足球","瓢虫","便便","月亮","太阳","礼物","拥抱","强","弱","握手","胜利","抱拳","勾引","拳头","差劲","爱你","NO","OK","爱情","飞吻","跳跳","发抖","怄火","转圈","磕头","回头","跳绳","挥手","激动","街舞","献吻","左太极","右太极"];$("#xei-cmt-wrapper").on("mousemove",".xei-qq-face-wrapper a",function(t){var e=parseInt(this.dataset.idx);if(e!=i){var n=$(".xei-qq-face-wrapper > .face-preview");n.children("img").attr("src",h+"face/qq/qq_"+(e+100)+".gif"),n.children("span").html(a[e]),[0,1,2,15,16,17,30,31,32].indexOf(e)>=0?n.addClass("right"):n.removeClass("right"),i<0&&n.show(),i=e}}),$("#xei-cmt-wrapper").on("mouseleave",".xei-qq-face-wrapper",function(t){$(".xei-qq-face-wrapper > .face-preview").hide();i=-1}),$("#xei-cmt-wrapper").on("click",".xei-cmt-icon-emoji",function(e){t(!0,this)}),$("#xei-cmt-wrapper").on("click",".xei-qq-face-wrapper a",function(e){var i=parseInt(this.dataset.idx);!function(t,e){if(document.selection)t.focus(),sel=document.selection.createRange(),sel.text=e,sel.select();else if(t.selectionStart||"0"==t.selectionStart){var i=t.selectionStart,a=t.selectionEnd,n=t.scrollTop;t.value=t.value.substring(0,i)+e+t.value.substring(a,t.value.length),n>0&&(t.scrollTop=n),t.focus(),t.selectionStart=i+e.length,t.selectionEnd=i+e.length}else t.value+=e,t.focus()}($(this).parents(".xei-cmt-replybox").find("textarea")[0],"[qq_"+(i+100)+"]"),t(!1)})}()}function e(){d("https://graph.qq.com/oauth2.0/authorize?response_type=token&client_id="+k+"&redirect_uri="+encodeURIComponent(_)+"&state=ssss")}function i(){d("https://api.weibo.com/oauth2/authorize?client_id="+g+"&response_type=code&redirect_uri="+encodeURIComponent(y))}function a(t,e){function i(t,e){if(e=void 0==e||e,!t||!t.length)return"";for(var a="<ul "+(e?"":'class="xei-cmt-children-wrapper"')+">",n=0;n<t.length;n++){var r=t[n];a+=c(r,!0),a+=i(r.children,!1),a+="</li>"}return a+="</ul>"}function a(t,e){if(e<=1)return"";for(var i="",a=0;a<e;a++)i+=a+1==t?"<span>"+t+"</span>":'<a href="javascript:;" data-page="'+(a+1)+'">'+(a+1)+"</a>";return html='\n\t\t\t\t<div class="xei-cmt-page">\n\t\t\t\t\t<a href="javascript:;" data-page="1">首页</a>\n\t\t\t\t\t'+i+'\n\t\t\t\t\t<a href="javascript:;" data-page="'+e+'">尾页</a>\n\t\t\t\t</div>'}t=t||1,e=e||100,$.get(w+"/query_comment_list",{type:j,targetKey:z,current:t,pageSize:e,sortType:I},function(t){console.log(t);var e=$("#xei-cmt-wrapper .xei-cmt-comments");if(0==t.code){r(t.commentCount);var n=function(t){for(var e=[],i={},a=0;a<t.length;a++)t[a].children=[],i[t[a].id]=t[a];for(a=0;a<t.length;a++){var n=t[a];if(null==n.parentId)e.push(n);else{var r=i[n.parentId];r&&r.children.push(n)}}return e}(t.pb.dataList);if(0!=n.length){var c=i(n);c+=a(t.pb.current,t.pb.pageCount),e.html(c)}else e.html('<p class="comment-tip">暂无评论！</p>')}else e.html("评论加载失败！")})}function n(t,e){if(e||L.id){var i=$(t).val();if(i){var a=t.dataset.parentId,n=t.dataset.rootId,c={type:j,targetKey:z,content:i,parentId:a,rootId:n};e&&(c.visitorName=e.visitorName||null,c.visitorEmail=e.visitorEmail||null,c.visitorWebsite=e.visitorWebsite||null),T.textarea=null,x("/add_comment",c,function(e){if(t.blur(),a){var i=$(t).parents("li.xei-cmt-comment:first");(n=i.children("ul")).length||(n=$('<ul class="xei-cmt-children-wrapper"></ul>')).appendTo(i),l(n,e.comment),$(t).parent().parent().remove()}else{$(t).val("");var n=$("#xei-cmt-wrapper .xei-cmt-comments > ul");n.length||($("#xei-cmt-wrapper .xei-cmt-comments").html("<ul></ul>"),n=$("#xei-cmt-wrapper .xei-cmt-comments > ul")),l(n,e.comment)}r(++E)})}else u("评论内容不能为空！")}else!function(t){T.textarea=t,T.open()}(t)}function r(t){E=t,$("#xei-cmt-wrapper .xei-cmt-count span").html(E)}function c(t,e){return'\n\t\t\t<li class="xei-cmt-comment" data-cmt-id="'+t.id+'">\n\t\t\t\t<div class="xei-cmt-item">\n\t\t\t\t\t<div class="xei-cmt-avatar">\n\t\t\t\t\t\t<a href="'+(t.userWebsite||"javascript:;")+'" title="'+t.userName+'" target="_blank">\n\t\t\t\t\t\t\t<img src="'+p(t.userAvatar)+'"/>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="xei-cmt-comment-body">\n\t\t\t\t\t\t<div class="xei-cmt-comment-header">\n\t\t\t\t\t\t\t<a href="javascript:;">'+(t.userName||"")+"</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<p>"+function(t){return t.replace(/\[qq_(\d+?)\]/g,'<img src="'+h+'face/qq/qq_$1.gif"/>')}(t.content)+'</p>\n\t\t\t\t\t\t<div class="xei-cmt-comment-footer">\n\t\t\t\t\t\t\t<span class="xei-cmt-time" title="'+xei.formatDate(t.commentTime)+'">'+xei.formatDateToFriendly(t.commentTime)+'</span>\n\t\t\t\t\t\t\t<a href="javascript:;" data-reply-id="'+t.id+'">\n\t\t\t\t\t\t\t\t<span class="xei-cmt-icon xei-cmt-icon-reply"></span>回复\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t<a href="javascript:;" data-zan-id="'+t.id+'">\n\t\t\t\t\t\t\t\t<span class="xei-cmt-icon xei-cmt-icon-like"></span>顶(<span class="zan-count">'+t.zan+'</span>)\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t<a href="javascript:;" class="xei-cmt-delete-btn" data-del-id="'+t.id+'" style="display:'+(t.user&&t.user.id==L.id||N?"inline":"none")+'">\n\t\t\t\t\t\t\t\t<span class="xei-cmt-icon xei-cmt-icon-delete"></span>删除\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t'+(e?"":"</li>")}function s(t,e){return e=e||"",t=t||"",'\n\t\t\t<div class="xei-cmt-replybox">\n\t\t\t\t<div class="xei-cmt-avatar">\n\t\t\t\t\t<a href="'+(L.website||"javascript:;")+'" title="'+L.nickname+'" target="_blank">\n\t\t\t\t\t\t<img src="'+p(L.avatar)+'"/>\n\t\t\t\t\t</a>\n\t\t\t\t\t<div class="xei-cmt-nickname">'+L.nickname+'</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="xei-cmt-post-wrapper">\n\t\t\t\t\t<textarea placeholder="各位程序猿大大和程序媛妹妹，来都来了，那就说点什么吧~~" data-parent-id="'+t+'" data-root-id="'+e+'"></textarea>\n\t\t\t\t\t<div class="xei-cmt-post-toolbar">\n\t\t\t\t\t\t<a href="javascript:;" title="插入表情" class="xei-cmt-icon xei-cmt-icon-emoji"></a>\n\t\t\t\t\t\t<div class="xei-cmt-login-wrapper" style="display:'+(L.id?"none":"inline-block")+'">\n\t\t\t\t\t\t\t<span class="xei-cmt-login-tip">使用社交账号登录</span>\n\t\t\t\t\t\t\t<a href="javascript:;" title="使用QQ账号登录" class="xei-cmt-icon-qq"></a>\n\t\t\t\t\t\t\t<a href="javascript:;" title="使用微博账号登录" class="xei-cmt-icon-weibo"></a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<a href="javascript:;" class="xei-cmt-post-button">发表</a>\n\t\t\t\t\t\t<span class="xei-cmt-post-tip" style="display:'+(L.id?"none":"block")+'">发表评论前请先登录</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t'+function(){for(var t="",e=0;e<105;e++)t+='<li><a href="javascript:;" data-idx="'+e+'"></a></li>';return'\n\t\t\t<div class="xei-qq-face-wrapper">\n\t\t\t\t<div class="face-preview">\n\t\t\t\t\t<img />\n\t\t\t\t\t<span>微笑</span>\n\t\t\t\t</div>\n\t\t\t\t<ul>\n\t\t\t\t\t'+t+"\n\t\t\t\t</ul>\n\t\t\t</div>"}()+"\n\t\t\t</div>"}function o(t){$(".xei-cmt-visitor-post-form")[t?"show":"hide"](),$(".xei-cmt-login-type-select")[t?"hide":"show"]()}function l(t,e){var i=$(c(e));i.hide(),"newly"==I&&null==e.parentId?t.prepend(i):t.append(i),i.show("normal")}function p(t){return t?/^(http|\/\/)/g.test(t)?t:"//res."+f+t:b}function m(){var t=$("#xei-cmt-wrapper .xei-cmt-replybox .xei-cmt-avatar a");t.attr("href",L.website||"/"),t.attr("title",L.nickname||""),t.children().attr("src",p(L.avatar)),$("#xei-cmt-wrapper .xei-cmt-replybox .xei-cmt-nickname").html(L.nickname),$("#xei-cmt-wrapper .xei-cmt-toolbar .xei-cmt-top-name").html(L.nickname),$("#xei-cmt-wrapper .xei-cmt-replybox .xei-cmt-login-wrapper").css("display",L.id?"none":"inline-block"),$("#xei-cmt-wrapper .xei-cmt-replybox .xei-cmt-post-tip").css("display",L.id?"none":"block"),$("#xei-cmt-wrapper .xei-cmt-toolbar").css("visibility",L.id?"visible":"hidden")}function d(t,e,i){e=e||600,i=i||400;var a=(window.screen.width-e)/2,n=(window.screen.height-i)/2;window.open(t,"_blank","toolbar=yes, location=yes, directories=no, status=no, menubar=yes, scrollbars=yes, resizable=no, copyhistory=yes, left="+a+", top="+n+", width="+e+", height="+i)}function v(t,e,i){$.fn.jBox("Notice",{content:t,autoClose:1e3*(i||2),fade:100,animation:"slide",color:e||"red"})}function u(t){v(t,"red")}function x(t,e,i,a){$.ajax({url:w+t,xhrFields:{withCredentials:!0},type:"post",data:e,success:function(t){a?i(t):0==t.code?i(t):u(t.text)}})}if(window.jQuery&&window.xei&&window.jBox){var f="haoji.me",h="//res."+f+"/blog/images/",w="//blog."+f,b=h+"default_avatar.gif",g="593718136",y="http://blog."+f+"/auth_weibo",k="101439209",_="http://blog."+f+"/auth_qq",q=$("#xei-cmt-wrapper");if(0!=q.length){var j=q[0].dataset.commentType,z=q[0].dataset.commentKey,C="sort_type",I=xei.getCookie(C,"newly"),E=0,N=""!==xei.getCookie("BSESSIONID",""),T=null,W=null,L={avatar:"",nickname:"游客",website:"/"};$(function(){!function(){var t='\n\t\t\t<div class="xei-cmt-toolbar" style="visibility:hidden;display:'+(N?"none":"block")+'">\n\t\t\t\t<div>\n\t\t\t\t\t<span class="xei-cmt-top-name">'+L.nickname+'</span>\n\t\t\t\t\t<span class="xei-cmt-settings">\n\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t<span class="xei-cmt-icon xei-cmt-icon-settings"></span>\n\t\t\t\t\t\t\t<span>设置</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t<li><a href="javascript:;" id="xei-cmt-logout">退出登录</a></li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t'+s()+'<div class="xei-cmt-top">\n\t\t\t\t<a href="javascript:;" class="xei-cmt-count">\n\t\t\t\t\t<span>0</span>条评论\n\t\t\t\t</a>\n\t\t\t\t<div class="xei-cmt-sort">\n\t\t\t\t\t<a href="javascript:;" data-sort-type="early" class="'+("early"==I?"current":"")+'">最早</a>\n\t\t\t\t\t<a href="javascript:;" data-sort-type="newly" class="'+("newly"==I?"current":"")+'">最新</a>\n\t\t\t\t\t<a href="javascript:;" data-sort-type="hot" class="'+("hot"==I?"current":"")+'">最热</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="xei-cmt-comments">\n\t\t\t\t<p class="comment-tip">正在加载评论</p>\n\t\t\t</div>';$("#xei-cmt-wrapper").html(t)}(),t(),a(),x("/open_user_auth",{},function(t){0==t.code&&(L=t.user,m())},!0),function(){var t='\n\t\t\t<div id="jbox_modal_visitor_post" style="display:none;">\n\t\t\t\t<div class="xei-cmt-login-type-select">\n\t\t\t\t\t<div><a href="javascript:;" class="btn-qq-login">用QQ账号登录</a></div>\n\t\t\t\t\t<div><a href="javascript:;" class="btn-weibo-login"></a></div>\n\t\t\t\t\t<div><a href="javascript:;" class="btn-visitor-login">以游客身份评论</a></div>\n\t\t\t\t</div>\n\t\t\t\t<form class="xei-cmt-visitor-post-form">\n\t\t\t\t\t<p class="top-post-tip">友情提示：以游客身份发表的评论无法删除哦！ <a href="javascript:;" class="back-to-select-login-type">返回继续登录</a></p>\n\t\t\t\t\t<div class="xei-cmt-form-group">\n\t\t\t\t\t\t<label for="visitorName">昵称</label>\n\t\t\t\t\t\t<input type="text" id="visitorName" name="visitorName" placeholder="填写一个你喜欢的昵称" value="'+xei.getCookie("visitor_name","")+'"/>\n\t\t\t\t\t\t<span class="required-tip">*</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="xei-cmt-form-group">\n\t\t\t\t\t\t<label for="visitorEmail">邮箱</label>\n\t\t\t\t\t\t<input type="text" id="visitorEmail" name="visitorEmail" placeholder="不会被公开，仅为了评论收到回复时邮件提醒" value="'+xei.getCookie("visitor_email","")+'"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="xei-cmt-form-group">\n\t\t\t\t\t\t<label for="visitorWebsite">个人主页</label>\n\t\t\t\t\t\t<input type="text" id="visitorWebsite" name="visitorWebsite" placeholder="填写个人网站或博客地址，仅为了互相学习交流" value="'+xei.getCookie("visitor_website","")+'"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="xei-cmt-form-group">\n\t\t\t\t\t\t<input type="button" id="visitor_post_comment_btn" value="发表评论"/>\n\t\t\t\t\t\t<span class="visitor-form-post-tip">标 * 为必填项</span>\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t</div>';$(t).appendTo($("body")),T=new jBox("Modal",{attach:$("#xei-cmt-wrapper .xei-cmt-visitor-post"),width:580,height:300,title:"请登录",overlay:!0,content:$("#jbox_modal_visitor_post"),draggable:"title",closeButton:"title"}),$(".xei-cmt-login-type-select .btn-visitor-login").click(function(){o(!0)}),$(".back-to-select-login-type").click(function(){o(!1)}),$(".xei-cmt-login-type-select .btn-qq-login").click(function(){T.close(),e()}),$(".xei-cmt-login-type-select .btn-weibo-login").click(function(){T.close(),i()}),$("#visitor_post_comment_btn").click(function(){var t={visitorName:$(".xei-cmt-visitor-post-form #visitorName").val(),visitorEmail:$(".xei-cmt-visitor-post-form #visitorEmail").val(),visitorWebsite:$(".xei-cmt-visitor-post-form #visitorWebsite").val()};!t.visitorName||/^[a-zA-Z0-9\u2E80-\u9FFF]{1,20}$/.test(t.visitorName)?!t.visitorEmail||/^[a-zA-Z\d][\w-\.]*@([\da-zA-Z](-[\da-zA-Z])?)+(\.[a-zA-Z]+)+$/g.test(t.visitorEmail)?!t.visitorWebsite||/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/.test(t.visitorWebsite)?(xei.setCookie("visitor_name",t.visitorName||""),xei.setCookie("visitor_email",t.visitorEmail||""),xei.setCookie("visitor_website",t.visitorWebsite||""),n(T.textarea,t),T.close()):u("主页地址不合法！"):u("邮箱格式不合法！"):u("昵称只能是字母数字或汉字，长度不超过20个哦！")})}()})}else console.error('请先在页面准备一个 <div id="xei-cmt-wrapper"></div> ！')}else alert("本插件依赖jQuery、xei、jBox这3个插件")}();